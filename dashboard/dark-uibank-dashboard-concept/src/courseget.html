<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Management</title>
    <style>
        .course-table {
            width: 100%;
            border-collapse: collapse;
        }

        .course-table th,
        .course-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        .course-table th {
            background-color: #f2f2f2;
        }

        .action-buttons {
            display: flex;
            justify-content: space-between;
        }
    </style>
</head>

<body>
    <div class="max-w-md bg-white p-8 rounded-md shadow-md">
        <h2 class="text-xl font-bold mb-4">Search Course</h2>
        <div id="courses-container"></div>
    </div>

    <script>
        // Mendapatkan kontainer untuk menampilkan data kursus
        const coursesContainer = document.getElementById('courses-container');

        // Get JWT token from localStorage
        const token = localStorage.getItem('jwt_token');

        // Kirim permintaan HTTP GET ke endpoint API saat halaman dimuat
        window.addEventListener('DOMContentLoaded', () => {
            fetch('http://127.0.0.1:3000/api/getcourse', {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            })
            .then(response => {
                if (response.ok) {
                    return response.json();
                } else {
                    throw new Error('Failed to fetch courses');
                }
            })
            .then(data => {
                // Handle successful response here
                console.log('Courses fetched successfully:', data);

                // Buat tabel dan tambahkan ke dalam kontainer HTML
                const table = document.createElement('table');
                table.classList.add('course-table');

                // Buat header tabel
                const headers = Object.keys(data.data.course[0]); // Ambil semua kunci dari objek pertama
                const headerRow = document.createElement('tr');
                headers.forEach(headerText => {
                    const headerCell = document.createElement('th');
                    headerCell.textContent = headerText;
                    headerRow.appendChild(headerCell);
                });
                // Tambahkan kolom untuk aksi (delete dan update)
                const actionHeader = document.createElement('th');
                actionHeader.textContent = 'Actions';
                headerRow.appendChild(actionHeader);

                table.appendChild(headerRow);

                // Tambahkan data kursus ke dalam tabel
                data.data.course.forEach(course => {
                    const row = document.createElement('tr');
                    headers.forEach(headerText => {
                        const cell = document.createElement('td');
                        cell.textContent = course[headerText];
                        row.appendChild(cell);
                    });

                    // Tambahkan tombol delete ke setiap baris
                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = 'Delete';
                    deleteButton.addEventListener('click', () => {
                        fetch(`http://127.0.0.1:3000/api/deletecourse/${course.id}`, {
                            method: 'DELETE',
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        })
                        .then(response => {
                            if (response.ok) {
                                console.log(`Course with ID ${course.id} deleted successfully.`);
                                // Optionally, remove the row from the table upon successful deletion
                                row.remove();
                            } else {
                                throw new Error('Failed to delete course');
                            }
                        })
                        .catch(error => {
                            console.error('Failed to delete course:', error);
                        });
                    });

                    // Tambahkan tombol update ke setiap baris
                    const updateButton = document.createElement('button');
                    updateButton.textContent = 'Update';
                    updateButton.addEventListener('click', () => {
                        // Redirect to update course page or implement update form here
                        window.location.href = `updatecourse.html?courseId=${course.id}`;
                    });

                    const actionCell = document.createElement('td');
                    actionCell.appendChild(deleteButton);
                    actionCell.appendChild(updateButton);

                    row.appendChild(actionCell);

                    table.appendChild(row);
                });

                // Tambahkan tabel ke dalam kontainer HTML
                coursesContainer.appendChild(table);
            })
            .catch(error => {
                // Handle error here
                console.error('Failed to fetch courses:', error);
            });
        });
    </script>
</body>

</html>
